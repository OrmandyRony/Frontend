<!DOCTYPE html>

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
		integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
		integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
		integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
		integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
		crossorigin="anonymous"></script>



	<title>CINELLA - HOME</title>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="css/style2.css" type="text/css" media="all" />
	<!--[if IE 6]>
		<link rel="stylesheet" href="css/ie6.css" type="text/css" media="all" />
	<![endif]-->
	<script src="js/jspdf.min.js"></script>
	<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="js/jquery-func.js"></script>
</head>
<script>
		function generar() {
				var pdf = new jsPDF();
				pdf.text(20, 20, "Mostrando una Tabla con JsPDF y el Plugin AutoTable");

				var columns = ["Id", "Nombre", "Email", "Pais"];
				var data = [
					[1, "Hola", "hola@gmail.com", "Mexico"],
					[2, "Hello", "hello@gmail.com", "Estados Unidos"],
					[3, "Otro", "otro@gmail.com", "Otro"]];

				pdf.autoTable(columns, data,
					{ margin: { top: 25 } }
				);

				pdf.save('mipdf.pdf');
				
			}
</script>
<body>
	<!-- Shell -->
	<div id="shell">
		<!-- Header -->
		<div id="header">
			<h1> CINELLA </h1>
			<div class="social">
				<span>FOLLOW US ON:</span>
				<ul>
					<li><a class="twitter" href="#">twitter</a></li>
					<li><a class="facebook" href="#">facebook</a></li>
					<li><a class="vimeo" href="#">vimeo</a></li>
					<li><a class="rss" href="#">rss</a></li>
				</ul>
			</div>

			<!-- Navigation -->
			<div id="navigation">
				<ul>
					<li><a class="active" href="inicio.html">CARGAR PELICULAS</a></li>
					<li><a href="agregarFuncion.html">AGREGAR FUNCION</a></li>
					<li><a href="resenas.html">RESEÑAS</a></li>
					<li><a href="funciones.html">FUNCIONES</a></li>
					<li><a href="usuarios.html">USUARIOS</a></li>
					<li><a href="registrar">REGISTRAR USUARIO</a></li>
					<li><a href="perfil.html">PERFIL</a></li>
					<li><a href="index.html">CERRAR SESION</a></li>
				</ul>
			</div>
			<!-- end Navigation -->

			<!-- Sub-menu -->
			<div id="sub-navigation">
				<ul>
					<li><a href="#">SHOW ALL</a></li>
					<li><a href="#">LATEST TRAILERS</a></li>
					<li><a href="#">TOP RATED</a></li>
					<li><a href="#">MOST COMMENTED</a></li>
				</ul>
				<div id="search">
					<form action="home_submit" method="get" accept-charset="utf-8">
						<label for="search-field">SEARCH</label>
						<input type="text" name="search field" value="Enter search here" id="search-field"
							title="Enter search here" class="blink search-field" />
						<input type="submit" value="GO!" class="search-button" />
					</form>
				</div>
			</div>
			<!-- end Sub-Menu -->

		</div>
		<!-- end Header -->

		<!-- Main -->
		<div id="main">
			<!-- Content -->
			<div id="content">

				<!-- Box -->

				<div class="box">
					<input class="btn btn-primary" type="file" accept="text/plain" onchange="abrirArchivo(event)"
						class="btn btn-warning" value="Cargar Peliculas">
					<div id="texto"></div>
				</div>
				<!-- end Box -->
				<a id="descargar" onclick="generar()">descargar</a>
				<script>
					var abrirArchivo = function (event) {
						var archivo = event.target;
						var reader = new FileReader();
						reader.onload = function () {
							var contenido = reader.result;
							document.getElementById("texto").innerHTML = contenido;
							json_peticion = JSON.stringify({ contenido: contenido })
							let respuesta = fetch('http://localhost:5000/leerArchivo', {
								method: 'POST',
								body: json_peticion,
								headers: { 'Content-Type': 'application/json' }
							})
							alert("Peliculas Ingresadas")
						};
						reader.readAsText(archivo.files[0])
					};

					function pdf() {
						var contenidoDeArchivo = "Hola Mundo!";
						elem.download = "archivo.txt";
						elem.href = "data:application/octet-stream,"
							+ encodeURIComponent(contenidoDeArchivo);

					}
				</script>
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold text-danger">Funciones</h6>
					</div>
					<div class="card-body">
						<div id="tabla" class="table-responsive">

						</div>
					</div>
				</div>

			</div>
			<!-- end Main -->

			<!-- Footer -->
			<div id="footer">
				<p>
					<a href="#">HOME</a> <span>|</span>
					<a href="#">NEWS</a> <span>|</span>
					<a href="#">IN THEATERS</a> <span>|</span>
					<a href="#">COMING SOON </a> <span>|</span>
					<a href="#">LATERS TRAILERS</a> <span>|</span>
					<a href="#">TOP RATED TRAILERS</a> <span>|</span>
					<a href="#">MOST COMMENTED TRAILERS</a> <span>|</span>
					<a href="#">ADVERTISE</a> <span>|</span>
					<a href="#">CONTACT </a>
				</p>
				<p> &copy; 2009 Movie Hunter, LLC. All Rights Reserved. Designed by <a href="http://chocotemplates.com"
						target="_blank" title="The Sweetest CSS Templates WorldWide">ChocoTemplates.com</a></p>
			</div>
			<!-- end Footer -->
		</div>
		<!-- end Shell -->
		<script>

			let xhr = new XMLHttpRequest();
			var ruta = 'http://localhost:5000/obtenerPeliculas';
			xhr.open('GET', ruta);
			xhr.send()
			xhr.onreadystatechange = (e) => {
				var peliculas = JSON.parse(xhr.responseText);
				var html = '<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"><thead><tr><th>Título</th><th>Eliminar</th><th>Editar</th></tr></thead>'
				html += '<tbody>'
				for (var i = 0; i < peliculas.length; i++) {
					html += '<tr>'
					html += '<td>' + peliculas[i].pelicula + '</td>'


					html += `<td><center><button type="button" onclick="eliminarPelicula(${i})" class="btn btn-danger">Eliminar</button></center></td>`
					html += `<td><center><a class="btn btn-primary" href="./editarPeliculas.html?pelicula=${peliculas[i].pelicula}" role="button">Editar</a></center></td>`
					html += '<tr>'
				}
				html += '</tbody></table>'
				console.log(html)
				document.getElementById("tabla").innerHTML = html
			}
			function eliminarPelicula(id) {
				let xhr = new XMLHttpRequest();
				var ruta = 'http://localhost:5000/eliminarPelicula';

				let json = JSON.stringify({
					identificador: id
				})
				xhr.open("POST", ruta)
				xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8')
				xhr.send(json)

				alert("Pelicula eliminada")
				window.location.href = "./inicio.html"
			}

	
		</script>
</body>

</html>